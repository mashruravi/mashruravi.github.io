<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.1db540ecee05b1203c9d.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css?family=Raleway|Roboto&display=swap);@font-face{font-family:Socialico;src:url(/static/Socialico-Regular-1fd9a7b1ba4a914c010b8a8ff0636c61.woff)}@font-face{font-family:SocialicoPlus;src:url(/static/SocialicoPlus-Plus-36c8776ee66b40b4175cfc1bb94e275f.woff)}body{margin:0;-moz-osx-font-smoothing:grayscale;font-family:Roboto,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased}header{height:48px;display:flex;justify-content:center;align-items:center;padding:0 16px;background-color:rgba(0,0,0,.8);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);transition:background-color .5s}header.expanded{background-color:#000}.hdr-normal{display:block}.hdr-col{display:none}.header-link{color:#fff;text-decoration:none;font-family:Raleway;margin:0 18px;padding:8px 16px;border-radius:10px}.prf-hdr-grid-ctr{display:flex}.prf-hdr-ctr{color:#6c6c6c;font-size:36px;margin:36px auto;display:grid;grid-template-columns:minmax(250px,25%) auto}.prf-hdr-intro>div{line-height:36px;margin-bottom:16px;margin-top:16px}.prf-hdr-intro strong{color:#19b6ff}.prf-hdr-img{margin:auto;grid-row-start:1;grid-row-end:3}.prf-hdr-social{display:flex}.hdr-col-menu{width:50px;height:40px;position:relative;cursor:pointer}.hdr-col-menu-bar{position:absolute;height:1px;background-color:#fff;left:12px;right:12px}.hdr-col-menu-bar-1{top:14px;transition:top .25s ease-out .15s,transform .15s ease-out}.hdr-col-menu-bar-2{bottom:14px;transition:bottom .25s ease-out .15s,transform .15s ease-out}.hdr-col-menu-bar-1-open{top:19px;transform:rotate(45deg);transition:top .15s ease-out,transform .25s ease-out .15s}.hdr-col-menu-bar-2-open{bottom:19px;transform:rotate(-45deg);transition:bottom .15s ease-out,transform .25s ease-out .15s}.hdr-col-itm-ctr{background-color:#000;position:absolute;left:0;right:0;top:48px;height:0;transition:.35s ease-out;overflow:hidden}.hdr-col-itm-ctr-exp{height:calc(100vh - 48px)}.hdr-col-itm-ctr-inner{display:flex;flex-direction:column;align-items:center;opacity:0;transition:opacity .25s ease-out .1s}.hdr-col-itm-ctr-inner-exp{opacity:1}.header-link-col{font-size:36px;height:48px;text-decoration:none;margin:16px 0;display:flex;align-items:center;color:#fff;padding:8px 24px;border-radius:10px}.section-container{margin:16px 64px;padding:32px 0}.section-header{color:#6c6c6c;font-size:32px;font-weight:700;text-align:center;margin:16px 0}.section-body{display:flex;flex-wrap:wrap;justify-content:center;margin:0 auto}.tech-item{display:flex;flex-direction:column;justify-content:flex-start;align-items:center;box-sizing:border-box;padding:16px;width:180px}.tech-item>img{height:60px}.tech-item>span{color:#6c6c6c;margin:8px 0}.proj-item{width:500px;height:380px;box-shadow:0 0 8px 0 rgba(0,0,0,.2),0 0 50px 0 rgba(0,0,0,.09);margin:24px;color:#6c6c6c;display:flex;flex-direction:column;box-sizing:border-box;position:relative;cursor:pointer;transition:box-shadow .2s ease-out}.proj-item:hover{box-shadow:0 0 16px 0 rgba(0,0,0,.2),0 0 50px 0 rgba(0,0,0,.09)}.proj-item:hover .proj-item-overlay{opacity:1}.proj-item-image,.proj-item-image-ctr{width:100%;height:100%}.proj-item-image{-o-object-fit:cover;object-fit:cover}.proj-item-overlay{opacity:0;padding:16px;position:absolute;background-color:rgba(0,0,0,.8);color:#fff;top:0;bottom:0;left:0;right:0;transition:opacity .5s}.proj-item-title{font-size:24px;font-weight:700;margin:24px 0;text-align:center}.proj-item-desc{font-size:24px;margin:0 16px;text-align:center}.proj-item-spacer{margin:auto}footer{padding:48px 16px}.blog-header{color:#6c6c6c;font-size:36px;text-align:center}.blog-list{max-width:650px;margin:0 auto;padding:0 16px}.blog-list-item{display:flex;flex-direction:column;margin:24px 0;padding:16px;color:#6c6c6c;text-decoration:none;transition:color .15s linear,border .15s linear;font-size:18px;box-sizing:border-box;border:1px solid transparent}.blog-list-item span:nth-child(2){font-size:12px}.blog-list-item:hover{color:#0c0c0c;border:1px solid rgba(0,0,0,.3)}.blog-content{padding:0 16px;max-width:800px;margin:0 auto;line-height:1.5;font-family:-apple-system,BlinkMacSystemFont,Roboto,Helvetica Neue,Arial,sans-serif}.blog-content blockquote{background:rgba(0,0,0,.03);padding:8px 32px;white-space:break-spaces;word-wrap:break-word}.blog-content h1{color:#6c6c6c}.blog-body{margin-bottom:36px;text-align:justify}.blog-body code{background-color:#d3d3d3;padding:4px 6px}.blog-body pre{background:#d3d3d3;padding:24px 12px;overflow:scroll;font-size:1.2rem}.blog-body pre code{padding:0}@media only screen and (max-width:750px){.prf-hdr-ctr{grid-template-columns:100%;font-size:24px;margin:16px;text-align:center;width:100%}.prf-hdr-intro>div{line-height:24px;margin-bottom:16px}.prf-hdr-img{margin:24px auto}.prf-hdr-social{margin:0 auto}.hdr-normal{display:none}header{justify-content:flex-end}.hdr-col{display:block}.section-container{margin:64px 8px;padding:0}.tech-item{width:110px}.tech-item>img{height:36px}.tech-item>span{text-align:center}.proj-item{width:300px;height:220px;margin:24px}.proj-item-title{font-size:22px;margin:24px 0;text-align:center}.proj-item-desc{font-size:16px}footer{padding:24px 8px}.blog-header{text-align:left;padding:0 16px}.blog-content h1{text-align:center}}@media only screen and (min-width:751px) and (max-width:900px){.prf-hdr-ctr{font-size:26px}.section-container{margin:32px 16px}.proj-item{width:300px;height:220px;margin:24px}.proj-item-title{font-size:22px;margin:24px 0;text-align:center}.proj-item-desc{font-size:16px}footer{padding:48px 16px}.blog-header{text-align:center}}.social-icon{margin:0 8px;font-size:64px}.social-icon>a{text-decoration:none;color:#6c6c6c;transition:.15s linear}.si{font-family:Socialico}.sip{font-family:SocialicoPlus}.si-linkedin>a:hover{color:#0077b5}.si-twitter>a:hover{color:#1ea1f2}.si-mail>a:hover{color:red}.si-github>a:hover{color:#000}</style><meta name="generator" content="Gatsby 2.31.1"/><title data-react-helmet="true">Mass Delete Messages on Slack - Blog - Ravi Mashru</title><meta data-react-helmet="true" name="description" content="Ravi Mashru&#x27;s home page on the internet - personal portfolio, blog and notes."/><meta data-react-helmet="true" property="og:title" content="Mass Delete Messages on Slack - Blog"/><meta data-react-helmet="true" property="og:description" content="Ravi Mashru&#x27;s home page on the internet - personal portfolio, blog and notes."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@mashruravi"/><meta data-react-helmet="true" name="twitter:title" content="Mass Delete Messages on Slack - Blog"/><meta data-react-helmet="true" name="twitter:description" content="Ravi Mashru&#x27;s home page on the internet - personal portfolio, blog and notes."/><link rel="icon" href="/favicon-32x32.png?v=86476019a66cd05dc3116d3ffde5ff93" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#323232"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=86476019a66cd05dc3116d3ffde5ff93"/><link as="script" rel="preload" href="/webpack-runtime-3acf2310e2b150f8f965.js"/><link as="script" rel="preload" href="/framework-741ade27086b2708e961.js"/><link as="script" rel="preload" href="/app-4bb33029cc1bf54f0b6b.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-69d67839b5d44cb35357.js"/><link as="script" rel="preload" href="/component---src-components-blog-layout-js-31e6c84f998402f3e848.js"/><link as="fetch" rel="preload" href="/page-data/blog/2020-07-19-slack-mass-delete/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3069025275.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="position:fixed;top:0;left:0;right:0;z-index:1"><header class=""><div class="hdr-normal"><a class="header-link" href="/">Home</a><a class="header-link" href="/blog/">Blog</a><a class="header-link" href="https://github.com/mashruravi/notes" target="_blank" rel="noopener noreferrer">Notes</a></div><div class="hdr-col"><div class="hdr-col-menu"><div class="hdr-col-menu-bar hdr-col-menu-bar-1"></div><div class="hdr-col-menu-bar hdr-col-menu-bar-2"></div></div><div class="hdr-col-itm-ctr "><div class="hdr-col-itm-ctr-inner "><a class="header-link-col" href="/">Home</a><a class="header-link-col" href="/blog/">Blog</a><a class="header-link-col" href="https://github.com/mashruravi/notes" target="_blank" rel="noopener noreferrer">Notes</a></div></div></div></header></div><main style="padding-top:98px;min-width:350px;margin:auto;min-height:calc(100vh - 98px - 50px)"><div class="blog-content"><h1>Mass Delete Messages on Slack</h1><div class="blog-body"><main><p>My team had a channel on Slack that was rarely used. There was just a Twitter Slack app that would post tweets made by our company&#x27;s official Twitter account.
We wanted to bring that channel back to life, and also get rid of all the tweets. Removing the Twitter app from the channel was easy, but there was no way to get rid of all the messages it had posted.
The app had been posting multiple tweets a day for almost 2 years, so manually deleting each message was not feasible. Deleting the channel and creating it again with the same name was not an option either - we didn&#x27;t want to invite all the members again and lose all the messages other members had posted before the Twitter app took over!</p><p>I started looking for utilities that would help me delete all posts made by the Twitter app. I tried chrome extensions and command line utilities. Unfortunately, none of them worked. So I decided to use the Slack API to delete the messages using a script.</p><p>To use the Slack API, I had to create a Slack App and install it in my workspace. However, since we are on a Slack enterprise grid, an app manager first has to approve my app before I can install it and use it to delete messages. Usually, I am a very patient person. But this time, I did not feel like waiting for an arbitrary amount of time for an approval.</p><p>After playing around with Slack for some time in the browser, I noticed that you can use the cookie and the token to authenticate yourself using the API.
You can get these values by looking at the details of an authenticated call in the Network tab in Chrome&#x27;s DevTools.</p><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:block;width:100%;height:561px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACwUlEQVQ4y51UiW7bMAz1//9ZB2xNmiZxfMmSfCZOfMWJc749qUXbYcCQzsAzKZIiKZGU4y6X+PH0hPl8Dt/3obWGVspSRSqltFAPwqnrGqEQKDcVur7H8XTGSOwPB5wuF3z97g/AaXc7iOUC0ltBuEuUWqFkZoWSqNIETVkSBc59h9uw/8TBYMB16C21stMIZ+stEE6fkdKZmL0gmDyTzhDPXxG9TJFQbqAWc2gGTlfuB3Lfg6TdOgqQBz6SyS8emRmJJIcfCcgkRSQ1hNIIY0VeIdZvMi8UVh4ISZ20OmMf68Su46yAXCzgdFmKotoiywsoY8BNsUogafjG6zeeTiXlOs0Q0YFKMmsvKDfriIHNqZxahIgYPfR8BCvPUgPfXWG1WCLwPCgWLQ4jrJYuPEIEgdW7zEgEIXIGzBgoW87h7Ogw5tlLj/fCCMnrDAmpUXYqRhNHGFJtYfhGCoxFanVm73mdA80WqCsLp9vv7bGSPEex3qCqG1xZ/hse//5om77rIOPYNnOWZajp8Ha94n8/29gB7yRilfOitCiZ6Y7ytu3Qs9kNbRm463rb/Ea23e5QEU3Toucpt+znvt/DGY9HVKxy0zTc2NoMDTacHCOrqspuNrIrMz+fzxan8WRx5lRdzPp0stTZ0DgzmXEisqKw/HAc0TKLhlld73eMNOyHwWJgAv88cqtj5O4c68BD5nIEOS16PoN6fUEV+jjkKVot0RF9oizds+IGQ5ZY9GZN3VDkcCo6MzOcRyGk62I1mcCbTpFylBo2fc153nCuDcx6l2jLG2p0O6Iyek7chr6chhGiyU+UzLBh9Mt2g9OmxK3ZAV1D1O+UaL/wVl5/6o1uPMI58jJNH5rnq2YVr+/99Ohz9dfzNY7jxyMqRGSreny/+DsL8h3wx6KwVUwfxmxuxVc64Mzu9wMul7dW+C5+A7bbl/fVh5QNAAAAAElFTkSuQmCC" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;object-position:center;opacity:1;transition-delay:500ms;margin:0 auto"/><noscript><picture><source srcset="/static/f5393249b890b54ed993453ad329b47c/2a4de/slack_auth.png 1x,
/static/f5393249b890b54ed993453ad329b47c/db955/slack_auth.png 1.5x" /><img loading="lazy" width="600" height="561" srcset="/static/f5393249b890b54ed993453ad329b47c/2a4de/slack_auth.png 1x,
/static/f5393249b890b54ed993453ad329b47c/db955/slack_auth.png 1.5x" src="/static/f5393249b890b54ed993453ad329b47c/2a4de/slack_auth.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>I wrote the following code to fetch all the messages in the channel, and delete those that were posted by the Twitter app. Since the Slack API returns pages of results, I had to handle getting the next page of results as well.</p><div><pre class="prism-code language-typescript" style="color:#393A34;background-color:#f6f8fa;padding:20px"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// slack-cleaner.ts</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">HISTORY_ENDPOINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://&lt;workspace-name&gt;.slack.com/api/conversations.history&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DELETE_ENDPOINT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://&lt;workspace-name&gt;.slack.com/api/chat.delete&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">COOKIE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Deno</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;COOKIE&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Deno</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;TOKEN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHANNEL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;channel-id&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TWITTER_BOT_ID</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;slack-app-id&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;channel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CHANNEL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Keep track of cursor to fetch next page of results</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> next_cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">runDeleteLoop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;cusor&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> next_cursor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">HISTORY_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;POST&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token maybe-class-name">Cookie</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">COOKIE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> resJson </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messages </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resJson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">messages</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  next_cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resJson</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response_metadata</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">next_cursor</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> messagesFromTwitterBot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> messages</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">message</span><span class="token parameter punctuation" style="color:#393A34">:</span><span class="token parameter"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">bot_id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TWITTER_BOT_ID</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">subtype</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bot_message&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Total messages: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">messages</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">length</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Twitter bot messages: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">messagesFromTwitterBot</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">length</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> interval </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messagesFromTwitterBot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">clearInterval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">interval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">next_cursor </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Starting next page...</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runDeleteLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Cleanup completed!</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> messagesFromTwitterBot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">shift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">DELETE_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;POST&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Cookie</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">COOKIE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">statusText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// The delete endpoint has a Tier 3 rate limit. Approx. 1 request per second ensures we don&#x27;t hit the rate limit</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">runDeleteLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div></pre></div><p>This can then be run using <code>Deno</code> after setting the COOKIE and TOKEN environment variables as follows:</p><div><pre class="prism-code language-shell" style="color:#393A34;background-color:#f6f8fa;padding:20px"><div class="token-line" style="color:#393A34"><span class="token plain">$ deno run --allow-net --allow-env slack-cleaner.ts</span></div></pre></div><p>If you have not provided the cookie and token correctly, the API will return something like this:</p><div><pre class="prism-code language-json" style="color:#393A34;background-color:#f6f8fa;padding:20px"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ok&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;error&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;not_authed&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div></pre></div><p>Life would be much easier if Slack provided a feature to mass delete messages from a channel, at least for:</p><ul><li>Messages you have posted.</li><li>Messages posted by a Slack App.</li></ul></main></div></div></main><footer style="background-color:#6C6C6C;color:#FFF;font-size:12px"><div style="max-width:1100px;min-width:300px;margin:0 auto">© <!-- -->2021<!-- --> Ravi Suresh Mashru. All rights reserved.</div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020-07-19-slack-mass-delete/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2966d4d8fea208fd6f8f.js"],"app":["/app-4bb33029cc1bf54f0b6b.js"],"component---src-components-blog-layout-js":["/component---src-components-blog-layout-js-31e6c84f998402f3e848.js"],"component---src-pages-404-js":["/component---src-pages-404-js-689cfc1b5c0a2e8a2c2e.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-806e931df0ec1e623367.js"],"component---src-pages-index-js":["/component---src-pages-index-js-1b32ac085bafa8f65d36.js"],"component---src-pages-reading-list-js":["/component---src-pages-reading-list-js-d3c0034680be27e8676e.js"]};/*]]>*/</script><script src="/polyfill-2966d4d8fea208fd6f8f.js" nomodule=""></script><script src="/component---src-components-blog-layout-js-31e6c84f998402f3e848.js" async=""></script><script src="/commons-69d67839b5d44cb35357.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-4bb33029cc1bf54f0b6b.js" async=""></script><script src="/framework-741ade27086b2708e961.js" async=""></script><script src="/webpack-runtime-3acf2310e2b150f8f965.js" async=""></script></body></html>